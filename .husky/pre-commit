#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ¨ Formatting frontend..."
cd frontend
npx prettier --write --ignore-unknown .
cd ..

# Check if any Java files are being committed
if git diff --cached --name-only | grep -q "\.java$"; then
  echo "ğŸ“ Java files detected in commit"
  
  # Check if Docker backend is running
  if docker compose ps backend 2>/dev/null | grep -q "Up"; then
    echo "âœ… Docker is running"
    echo "ğŸ¨ Formatting backend..."
    docker compose exec -T backend ./mvnw spotless:apply
    git add -u
    echo "âœ… Backend formatted"
  else
    echo ""
    echo "âŒ ERROR: Docker backend is not running"
    echo ""
    echo "You're committing Java files, but Docker isn't running."
    echo ""
    echo "Start Docker with:"
    echo "  docker compose up -d backend"
    echo ""
    echo "Then try your commit again."
    echo ""
    exit 1
  fi
else
  echo "âœ… No Java files in commit - skipping backend check"
  git add -u
fi

echo "âœ… Done!"

